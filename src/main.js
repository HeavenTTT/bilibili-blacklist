/**
 * Bilibili-BlackList - ä¸»å…¥å£æ–‡ä»¶
 * æ•´åˆæ‰€æœ‰æ¨¡å—å¹¶åˆå§‹åŒ–è„šæœ¬
 */

import { StorageManager } from './storage/manager.js';
import { CoreBlocker } from './core/blocker.js';
import { UIManager } from './ui/manager.js';
import { PageObserver } from './observers/page-observers.js';
import { AdBlocker } from './adblock/main.js';

(function () {
  "use strict";

  /*
   * Bilibili-BlackList -- Bilibili UPå±è”½æ’ä»¶
   * é‡æ„ç‰ˆæœ¬ - æ¨¡å—åŒ–è®¾è®¡ï¼Œæé«˜å¯ç»´æŠ¤æ€§å’Œå¯è¯»æ€§
   * ä»£ç å·²ç”± QWEN Coder é‡æ„ä¸ºæ¨¡å—åŒ–ç»“æ„
   * this script is mainly generated by AI, the author doesn't know JavaScript at all, if there are bugs, please contact Gemini / ChatGPT / DeepSeek
   * æ„Ÿè°¢ä½ çš„ä½¿ç”¨
   * Thank you for using this script
   */

  // åˆå§‹åŒ–æ‰€æœ‰æ¨¡å—
  const storageManager = new StorageManager();
  const config = storageManager.getGlobalConfig();
  const blocker = new CoreBlocker(storageManager, config);
  const uiManager = new UIManager(storageManager, blocker);
  const pageObserver = new PageObserver(blocker, uiManager, storageManager);
  const adBlocker = new AdBlocker(storageManager, blocker);

  // æ·»åŠ å…¨å±€æ ·å¼
  uiManager.addGlobalStyles();

  // è®¾ç½®é¡µé¢å¯è§æ€§ç›‘å¬å™¨
  pageObserver.setupPageVisibilityListener();

  // ç›‘å¬DOMContentLoadedå¹¶æ£€æŸ¥readyStateä»¥è¿›è¡Œæ—©æœŸåˆå§‹åŒ–
  document.addEventListener("DOMContentLoaded", () => {
    pageObserver.initializeObserver();
  });
  
  if (
    document.readyState === "complete" ||
    document.readyState === "interactive"
  ) {
    pageObserver.initializeObserver();
  }

  // æš´éœ²ä¸€äº›åŠŸèƒ½åˆ°å…¨å±€ï¼Œæ–¹ä¾¿è°ƒè¯•
  window.BilibiliBlackList = {
    storageManager,
    blocker,
    uiManager,
    pageObserver,
    adBlocker,
    refreshUI: () => {
      uiManager.refreshAllPanelTabs();
      uiManager.refreshBlockCountDisplay();
    }
  };

  console.log("[bilibili-blacklist] é‡æ„ç‰ˆæœ¬å·²åŠ è½½ï¼Œæ¨¡å—åŒ–è®¾è®¡ ğŸš€");
})();