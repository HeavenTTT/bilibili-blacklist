// ==UserScript==
// @name         Bilibili-BlackList
// @namespace    https://github.com/HeavenTTT/bilibili-blacklist
// @version      1.1.8
// @author       HeavenTTT
// @description  Bilibili UPå±è”½æ’ä»¶ - å±è”½UPä¸»è§†é¢‘å¡ç‰‡ï¼Œæ”¯æŒç²¾ç¡®åŒ¹é…å’Œæ­£åˆ™åŒ¹é…ï¼Œæ”¯æŒè§†é¢‘é¡µé¢ã€åˆ†ç±»é¡µé¢ã€æœç´¢é¡µé¢ç­‰ã€‚
// @match        *://*.bilibili.com/*
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_addStyle
// @icon         https://www.bilibili.com/favicon.ico
// @license      MIT
// ==/UserScript==

(function () {
  "use strict";

  // å¯¼å…¥æ¨¡å—
  const StorageManager = window.BilibiliBlacklist.StorageManager;
  const CoreFeatures = window.BilibiliBlacklist.CoreFeatures;
  const VideoDataFetcher = window.BilibiliBlacklist.VideoDataFetcher;
  const UIElements = window.BilibiliBlacklist.UIElements;
  const PageDetection = window.BilibiliBlacklist.PageDetection;
  const AdBlocker = window.BilibiliBlacklist.AdBlocker;

  /* 
   * Bilibili-BlackList -- Bilibili UPå±è”½æ’ä»¶
   * è„šæœ¬å¤§éƒ¨åˆ†ä»£ç ç”±AIç”Ÿæˆï¼Œä½œè€…ä¸€ç‚¹éƒ½ä¸æ‡‚JavaScriptï¼Œå‡ºç°bugè¯·è”ç³»Gemini / ChatGPT / DeepSeek
   * this script is mainly generated by AI, the author doesn't know JavaScript at all, if there are bugs, please contact Gemini / ChatGPT / DeepSeek
   * æ„Ÿè°¢ä½ çš„ä½¿ç”¨
   * Thank you for using this script
   *
   * æœ¬æ®µæ³¨é‡Šä¸ºVS code è‡ªåŠ¨ç”Ÿæˆ this is a comment generated by VS code
   */

  //#region åˆå§‹åŒ–å’Œå…¥å£ç‚¹

  // åˆå§‹åŒ–è„šæœ¬
  function initializeScript() {
    // é‡ç½®çŠ¶æ€å˜é‡
    CoreFeatures.resetState();

    // æ ¹æ®å½“å‰é¡µé¢URLåˆ¤æ–­å¹¶åˆå§‹åŒ–
    if (PageDetection.isCurrentPageMain()) {
      PageDetection.initializeMainPage();
      AdBlocker.blockMainPageAds();
    } else if (PageDetection.isCurrentPageSearch()) {
      PageDetection.initializeSearchPage();
      AdBlocker.blockMainPageAds(); // æœç´¢é¡µä¹Ÿè¿›è¡Œä¸»é¡µå¹¿å‘Šå±è”½
    } else if (PageDetection.isCurrentPageVideo()) {
      PageDetection.initializeVideoPage();
    } else if (PageDetection.isCurrentPageCategory()) {
      PageDetection.initializeCategoryPage();
    } else if (PageDetection.isCurrentUserSpace()) {
      PageDetection.initializeUserSpace();
    } else {
      return; // ä¸æ”¯æŒçš„é¡µé¢ä¸è¿›è¡Œåˆå§‹åŒ–
    }
    UIElements.createBlacklistPanel(); // åˆ›å»ºç®¡ç†é¢æ¿
    console.log("[bilibili-blacklist] è„šæœ¬å·²åŠ è½½ğŸ¥”");
  }

  // ç›‘å¬DOMContentLoadedå¹¶æ£€æŸ¥readyStateä»¥è¿›è¡Œæ—©æœŸåˆå§‹åŒ–
  document.addEventListener("DOMContentLoaded", initializeScript);
  if (
    document.readyState === "complete" ||
    document.readyState === "interactive"
  ) {
    initializeScript();
  }

  //#endregion
})();